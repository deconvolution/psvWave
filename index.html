<!DOCTYPE html><html class=writer-html5 lang=en> <head><meta charset=utf-8><meta name=generator content="Docutils 0.17.1: http://docutils.sourceforge.net/"><meta name=viewport content="width=device-width, initial-scale=1.0"><title>Homepage &mdash; psvWave 74bfb8a901eff20e8c1eafefb967ba44dee5698d documentation</title><link rel=stylesheet href=_static/pygments.css type=text/css><link rel=stylesheet href=_static/css/theme.css type=text/css><!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]--><script data-url_root=./ id=documentation_options src=_static/documentation_options.js></script><script src=_static/jquery.js></script><script src=_static/underscore.js></script><script src=_static/doctools.js></script><script src=_static/add_class.js></script><script src=_static/js/theme.js></script><link rel=index title=Index href=genindex.html><link rel=search title=Search href=search.html><link rel=next title="Typical FWI workflow" href=typical-workflow.html></head> <body class=wy-body-for-nav> <div class=wy-grid-for-nav> <nav data-toggle=wy-nav-shift class=wy-nav-side> <div class=wy-side-scroll> <div class=wy-side-nav-search> <a href=# class="icon icon-home"> psvWave </a> <div class=version> 1.0 </div> <div role=search> <form id=rtd-search-form class=wy-form action=search.html method=get> <input type=text name=q placeholder="Search docs"> <input type=hidden name=check_keywords value=yes> <input type=hidden name=area value=default> </form> </div> </div><div class="wy-menu wy-menu-vertical" data-spy=affix role=navigation aria-label="Navigation menu"> <p class=caption role=heading><span class=caption-text>Table of contents</span></p> <ul class=current> <li class="toctree-l1 current"><a class="current reference internal" href=#>Homepage</a></li> <li class=toctree-l1><a class="reference internal" href=typical-workflow.html>Typical FWI workflow</a></li> <li class=toctree-l1><a class="reference internal" href=python/index.html>Python API reference</a></li> <li class=toctree-l1><a class="reference internal" href=cpp/index.html>C++ API reference</a></li> <li class=toctree-l1><a class="reference internal" href=genindex.html>Index</a></li> </ul> </div> </div> </nav> <section data-toggle=wy-nav-shift class=wy-nav-content-wrap><nav class=wy-nav-top aria-label="Mobile navigation menu"> <i data-toggle=wy-nav-top class="fa fa-bars"></i> <a href=#>psvWave</a> </nav> <div class=wy-nav-content> <div class=rst-content> <div role=navigation aria-label="Page navigation"> <ul class=wy-breadcrumbs> <li><a href=# class="icon icon-home"></a> &raquo;</li> <li>Homepage</li> <li class=wy-breadcrumbs-aside> <a href=_sources/index.rst.txt rel=nofollow> View page source</a> </li> </ul> <hr> </div> <div role=main class=document itemscope=itemscope itemtype=http://schema.org/Article> <div itemprop=articleBody> <section id=homepage> <h1>Homepage<a class=headerlink href=#homepage title="Permalink to this headline"></a></h1> <div class="toctree-wrapper compound"> <p class=caption role=heading><span class=caption-text>Table of contents</span></p> <ul class=current> <li class="toctree-l1 current"><a class="current reference internal" href=#>Homepage</a></li> <li class=toctree-l1><a class="reference internal" href=typical-workflow.html>Typical FWI workflow</a></li> <li class=toctree-l1><a class="reference internal" href=python/index.html>Python API reference</a><ul> <li class=toctree-l2><a class="reference internal" href=python/fdmodel/index.html>psvWave.fdModel</a></li> <li class=toctree-l2><a class="reference internal" href=python/configuration.html>Configuration files</a></li> </ul> </li> <li class=toctree-l1><a class="reference internal" href=cpp/index.html>C++ API reference</a><ul> <li class=toctree-l2><a class="reference internal" href=cpp/fdmodel/index.html>fdModel class</a></li> <li class=toctree-l2><a class="reference internal" href=cpp/miscellaneous.html>Miscellaneous methods and definitions</a><ul> <li class=toctree-l3><a class="reference internal" href=cpp/miscellaneous.html#making-contiguous-arrays>Making contiguous arrays</a></li> <li class=toctree-l3><a class="reference internal" href=cpp/miscellaneous.html#parse-functions>Parse functions</a></li> </ul> </li> <li class=toctree-l2><a class="reference internal" href=cpp/index.html#type-definitions>Type definitions</a></li> </ul> </li> <li class=toctree-l1><a class="reference internal" href=genindex.html>Index</a></li> </ul> </div> </section> <section id=psvwave> <h1>psvWave<a class=headerlink href=#psvwave title="Permalink to this headline"></a></h1> <a class="reference external image-reference" href=https://img.shields.io/pypi/pyversions/psvWave><img alt="PyPI - Python Version" src=https://img.shields.io/pypi/pyversions/psvWave></a> <a class="reference external image-reference" href=https://github.com/larsgeb/psvWave><img alt="Main GitHub Language" src=https://img.shields.io/github/languages/top/larsgeb/forward-virieux></a> <a class="reference external image-reference" href=https://github.com/larsgeb/psvWave/blob/master/LICENSE><img alt=GitHub src="https://img.shields.io/github/license/larsgeb/psvWave?color=4dc71f"></a> <a href=https://pypi.org/project/psvWave/ class="reference external image-reference"><img alt="PyPI version" src=https://badge.fury.io/py/psvWave.svg></a> <a href=https://larsgeb.github.io/psvWave/ class="reference external image-reference"><img alt src=https://img.shields.io/badge/docs-latest-brightgreen></a> <p><a class="reference external" href=https://user-images.githubusercontent.com/21038893/155033663-5e22b5ee-1b2b-43eb-9aab-74bfd85f2a73.mp4>https://user-images.githubusercontent.com/21038893/155033663-5e22b5ee-1b2b-43eb-9aab-74bfd85f2a73.mp4</a></p> <a class="reference external image-reference" href=https://user-images.githubusercontent.com/21038893/155048974-63ce3dd3-5c07-4650-a7f2-9c2105151642.png><img alt=Gradients src=https://user-images.githubusercontent.com/21038893/155048974-63ce3dd3-5c07-4650-a7f2-9c2105151642.png></a> <p><a class="reference external" href=https://github.com/larsgeb/psvWave/blob/master/notebooks/L-BFGS%20FWI.ipynb>Check out the notebook here!</a></p> <p>A Python/C++ package for 2D P-SV wave propagation using finite differences and OpenMP. This package was written to facilitate high-throughput numerical wave simulations for Monte Carlo simulation in Seismology. It uses the velocity-stress formulation on a staggered grid from <a class="reference external" href=https://doi.org/10.1190/1.1442147>Virieux’s classical 1986 paper</a>. For compilation we require only OpenMP and the git subrepos (header-only): <a class="reference external" href=http://eigen.tuxfamily.org>Eigen</a> and <a class="reference external" href=https://github.com/jtilly/inih>inih</a>, however installation can be easily done through pip. Used as a PDE-simulation code for <a class="reference external" href=https://doi.org/10.1029/2019JB018428>this publication</a>.</p> <section id=extremely-quick-start-using-docker> <h2>Extremely quick start using Docker<a class=headerlink href=#extremely-quick-start-using-docker title="Permalink to this headline"></a></h2> <p>The best way to run the code if you are not on Linux. Pull the docker image and start the notebook server on port 7999. Feel free to change the port 7999 to something of your preference.</p> <div class="highlight-bash notranslate"><div class=highlight><pre><span></span>docker run -it -p <span class=m>7999</span>:8888 larsgebraad/psvwave
</pre></div> </div> <p>You can then navigate in your browser to <code class="docutils literal notranslate"><span class=pre>localhost:7999</span></code>. This starts you right off with some fun notebooks!</p> <p>Note that the notebooks assume you have 6 cores available for your docker. You can specify how many cores are available by starting the Docker the following way:</p> <div class="highlight-bash notranslate"><div class=highlight><pre><span></span>docker run -it --cpus<span class=o>=</span><span class=m>2</span> -p <span class=m>7999</span>:8888 larsgebraad/psvwave
</pre></div> </div> </section> <section id=installing-the-package-using-pypi-pip> <h2>Installing the package using PyPi (pip)<a class=headerlink href=#installing-the-package-using-pypi-pip title="Permalink to this headline"></a></h2> <p>There are many ways to install this package. Installing directly from the PyPi archives is arguably the easiest:</p> <div class="highlight-bash notranslate"><div class=highlight><pre><span></span>pip install psvWave
</pre></div> </div> <p>To check if everything worked correctly, you can run the following in an interactive python shell or notebook:</p> <div class="highlight-python notranslate"><div class=highlight><pre><span></span><span class=gp>&gt;&gt;&gt; </span><span class=kn>import</span> <span class=nn>psvWave</span>
<span class=gp>&gt;&gt;&gt; </span><span class=nb>print</span><span class=p>(</span><span class=n>psvWave</span><span class=o>.</span><span class=n>__version__</span><span class=p>)</span>
</pre></div> </div> <p>If this raises an <code class="docutils literal notranslate"><span class=pre>ImportError</span></code>, the C++ packages have not correctly compiled and you are either on an unsupported system (Windows/MacOS) or I have made a terrible mistake. Please contact me in any case!</p> </section> <section id=getting-started> <h2>Getting started<a class=headerlink href=#getting-started title="Permalink to this headline"></a></h2> </section> <section id=working-with-the-configuration-files> <h2>Working with the configuration files<a class=headerlink href=#working-with-the-configuration-files title="Permalink to this headline"></a></h2> <p><strong>This section is a must read for anyone wishing to use this package.</strong></p> <p>An example configuration file is given below. The simulations performed make a few basic assumptions about the medium, wavefield and sources:</p> <section id=physics> <h3>1: Physics<a class=headerlink href=#physics title="Permalink to this headline"></a></h3> <p>All sources propagate waves through the same medium / domain, and are recorded by the same network. The physics is defined in a <strong>right-handed</strong> coordinate system. However, you are allowed to interpret the simulations in any unit and orientation you like. Just make sure you keep track of the units, and don’t use numbers outside the range of either <code class="docutils literal notranslate"><span class=pre>float</span></code> or <code class="docutils literal notranslate"><span class=pre>double</span></code> (the package is by default compiled with doubles). And, the physics is for <strong>in-plane</strong> shear waves.</p> </section> <section id=sources> <h3>2: Sources<a class=headerlink href=#sources title="Permalink to this headline"></a></h3> <p>All sources are normal/reverse faults (with strike parallel to the y-axis) with a Ricker wavelet of all the same frequency as source time function. Every source can have a different dip angle. This source time function can be altered in both the Python and C++ API, the focal mechanism /source type not (yet).</p> </section> <section id=simulations> <h3>3: Simulations<a class=headerlink href=#simulations title="Permalink to this headline"></a></h3> <p>Simulations are divided in ‘shots’, i.e. a single time length in which data is recorded and some ‘sources’ fire. It is thus allowed to have 2 sources in a single shot. This allows for source stacking. The delay_cycles_per_shot variable allows for time staggering, delaying the source time function per source by that many cycles. An example relevant to the given configuration file:</p> <div class="highlight-default notranslate"><div class=highlight><pre><span></span><span class=n>peak_frequency</span> <span class=o>=</span> <span class=mf>50.0</span>
</pre></div> </div> <p>Means all source time functions (STF) are a Ricker wavelet with peak (central) frequency of 50Hz.</p> <div class="highlight-default notranslate"><div class=highlight><pre><span></span><span class=n>delay_cycles_per_shot</span> <span class=o>=</span> <span class=mi>24</span>
</pre></div> </div> <p>Means that if 2 sources are present in a shot, the STF of the second shot is delayed by 24 cycles. For a peak frequency of 50 Hz, this turns out to be <code class="docutils literal notranslate"><span class=pre>24cycl</span> <span class=pre>/</span> <span class=pre>50cycl/s</span> <span class=pre>=</span> <span class=pre>0.48s</span></code>. Every subsequent shot is delayed after the previous by the same amount.</p> <div class="highlight-default notranslate"><div class=highlight><pre><span></span><span class=n>which_source_to_fire_in_which_shot</span> <span class=o>=</span> <span class=p>{{</span><span class=mi>0</span><span class=p>,</span> <span class=mi>1</span><span class=p>}}</span>
</pre></div> </div> <p>Means that both source 0 and source 1 (zero-based indexing) are fired in shot 1.</p> <p>In the below given configuration, total simulation time is 1 second. This means that the second shot is ‘fired’ at almost half the simulation time. The idea behind source stacking is that without strong reflections, we can take advantage of the position of the wavefields to simulate multiple shots at the same time, with minimal ‘cross-talk’.</p> </section> <section id=domain-and-boundary> <h3>4: Domain and boundary<a class=headerlink href=#domain-and-boundary title="Permalink to this headline"></a></h3> <p>The domain is truncated on all 4 sides by absorbing boundary conditions. It’s width is variable, but as of yet, the same on all sides. This does not directly allow for free boundary conditions, but this is planned to change. When measuring distance or counting gridpoints, the zero-point is the first points not inside the boundary layer but in the actual simulation medium. When updating medium properties within the domain, the boundary copies the medium properties closest to it, to avoid creating reflectors.</p> </section> <section id=indexing> <h3>5: Indexing<a class=headerlink href=#indexing title="Permalink to this headline"></a></h3> <p>The location of the sources and receivers is not expressed in distance, but in gridpoint numbering. Because the actual indexing starts within the medium, and not the absorbing boundary, sources and receivers can only be placed inside the medium. However, the nx_inner_boundary and nz_inner_boundary variables determine how many gridpoints are not considered free parameters. The idea behind this is that this allows us to place sources/receivers in regions of the domain that are not inverted for, and are also not inside the boundary. This to avoid near-source and near-receiver effects.</p> </section> <section id=example-file> <h3>Example file<a class=headerlink href=#example-file title="Permalink to this headline"></a></h3> <div class="highlight-default notranslate"><div class=highlight><pre><span></span><span class=p>[</span><span class=n>domain</span><span class=p>]</span>
<span class=n>nt</span> <span class=o>=</span> <span class=mi>4000</span>
<span class=n>nx_inner</span> <span class=o>=</span> <span class=mi>200</span>
<span class=n>nz_inner</span> <span class=o>=</span> <span class=mi>100</span>
<span class=n>nx_inner_boundary</span> <span class=o>=</span> <span class=mi>10</span>
<span class=n>nz_inner_boundary</span> <span class=o>=</span> <span class=mi>20</span>
<span class=n>dx</span> <span class=o>=</span> <span class=mf>1.249</span>
<span class=n>dz</span> <span class=o>=</span> <span class=mf>1.249</span>
<span class=n>dt</span> <span class=o>=</span> <span class=mf>0.00025</span>

<span class=p>[</span><span class=n>boundary</span><span class=p>]</span>
<span class=n>np_boundary</span> <span class=o>=</span> <span class=mi>25</span>
<span class=n>np_factor</span> <span class=o>=</span> <span class=mf>0.015</span>

<span class=p>[</span><span class=n>medium</span><span class=p>]</span>
<span class=n>scalar_rho</span> <span class=o>=</span> <span class=mf>1500.0</span>
<span class=n>scalar_vp</span> <span class=o>=</span> <span class=mf>2000.0</span>
<span class=n>scalar_vs</span> <span class=o>=</span> <span class=mf>800.0</span>

<span class=p>[</span><span class=n>sources</span><span class=p>]</span>
<span class=n>peak_frequency</span> <span class=o>=</span> <span class=mf>50.0</span>
<span class=n>n_sources</span> <span class=o>=</span> <span class=mi>2</span>
<span class=n>n_shots</span> <span class=o>=</span> <span class=mi>1</span>
<span class=n>source_timeshift</span> <span class=o>=</span> <span class=mf>0.005</span>
<span class=n>delay_cycles_per_shot</span> <span class=o>=</span> <span class=mi>24</span>
<span class=n>moment_angles</span> <span class=o>=</span> <span class=p>{</span><span class=mi>90</span><span class=p>,</span> <span class=mi>180</span><span class=p>}</span>
<span class=n>ix_sources</span> <span class=o>=</span> <span class=p>{</span><span class=mi>25</span><span class=p>,</span> <span class=mi>175</span><span class=p>}</span>
<span class=n>iz_sources</span> <span class=o>=</span> <span class=p>{</span><span class=mi>10</span><span class=p>,</span> <span class=mi>10</span><span class=p>}</span>
<span class=n>which_source_to_fire_in_which_shot</span> <span class=o>=</span> <span class=p>{{</span><span class=mi>0</span><span class=p>,</span> <span class=mi>1</span><span class=p>}}</span>

<span class=p>[</span><span class=n>receivers</span><span class=p>]</span>
<span class=n>nr</span> <span class=o>=</span> <span class=mi>19</span>
<span class=n>ix_receivers</span> <span class=o>=</span> <span class=p>{</span><span class=mi>10</span><span class=p>,</span> <span class=mi>20</span><span class=p>,</span> <span class=mi>30</span><span class=p>,</span> <span class=mi>40</span><span class=p>,</span> <span class=mi>50</span><span class=p>,</span> <span class=mi>60</span><span class=p>,</span> <span class=mi>70</span><span class=p>,</span> <span class=mi>80</span><span class=p>,</span> <span class=mi>90</span><span class=p>,</span> <span class=mi>100</span><span class=p>,</span> <span class=mi>110</span><span class=p>,</span> <span class=mi>120</span><span class=p>,</span> <span class=mi>130</span><span class=p>,</span> <span class=mi>140</span><span class=p>,</span> <span class=mi>150</span><span class=p>,</span> <span class=mi>160</span><span class=p>,</span> <span class=mi>170</span><span class=p>,</span> <span class=mi>180</span><span class=p>,</span> <span class=mi>190</span><span class=p>}</span>
<span class=n>iz_receivers</span> <span class=o>=</span> <span class=p>{</span><span class=mi>90</span><span class=p>,</span> <span class=mi>90</span><span class=p>,</span> <span class=mi>90</span><span class=p>,</span> <span class=mi>90</span><span class=p>,</span> <span class=mi>90</span><span class=p>,</span> <span class=mi>90</span><span class=p>,</span> <span class=mi>90</span><span class=p>,</span> <span class=mi>90</span><span class=p>,</span> <span class=mi>90</span><span class=p>,</span> <span class=mi>90</span><span class=p>,</span> <span class=mi>90</span><span class=p>,</span> <span class=mi>90</span><span class=p>,</span> <span class=mi>90</span><span class=p>,</span> <span class=mi>90</span><span class=p>,</span> <span class=mi>90</span><span class=p>,</span> <span class=mi>90</span><span class=p>,</span> <span class=mi>90</span><span class=p>,</span> <span class=mi>90</span><span class=p>,</span> <span class=mi>90</span><span class=p>}</span>

<span class=p>[</span><span class=n>inversion</span><span class=p>]</span>
<span class=n>snapshot_interval</span> <span class=o>=</span> <span class=mi>10</span>
</pre></div> </div> </section> </section> <section id=installing-from-github> <h2>Installing from GitHub<a class=headerlink href=#installing-from-github title="Permalink to this headline"></a></h2> <p>You might also be tempted to install it from tags or another GitHub hash. This has the problem however that submodules are not automatically downloaded. If you still wish to install from the repo, you have to clone it to your machine first, and then also pull all the submodules:</p> <div class="highlight-bash notranslate"><div class=highlight><pre><span></span>git clone --recursive https://github.com/larsgeb/psvWave.git
<span class=nb>cd</span> psvWave
</pre></div> </div> <p>Afterwards you can …</p> <ol class=arabic> <li><p>directly install from this directory:</p> <div class="highlight-bash notranslate"><div class=highlight><pre><span></span>pip install -e .
</pre></div> </div> </li> <li><p>create a source distribution (uncompiled) and install it on <em>any</em> machine:</p> <div class="highlight-bash notranslate"><div class=highlight><pre><span></span>python setup.py sdist
<span class=nb>cd</span> dist
pip install psvWave-*.tar.gz <span class=c1># this will compile the C++ modules</span>
</pre></div> </div> </li> <li><p>create a binary wheel in which the compiled code is present and install it on <em>similar</em> machines:</p> <div class="highlight-bash notranslate"><div class=highlight><pre><span></span>python setup.py bdist_wheel <span class=c1># this will compile the C++ modules</span>
<span class=nb>cd</span> dist
pip install psvWave-*.whl
</pre></div> </div> </li> </ol> <p>The main difference between 2 and 3 is that 2 doesn’t compile the C++ code yet at the distribution stage. Option 3 does compile in this stage, and therefore might not work on machines with wildly different architectures.</p> <p>If you are really at the end of your rope, we can also send a precompiled wheel for the platform you’re using.</p> </section> <section id=compiling-the-c-interface> <h2>Compiling the C++ interface<a class=headerlink href=#compiling-the-c-interface title="Permalink to this headline"></a></h2> <p>Compiling the C++ API into your C++ application is fairly straightforward. One needs an OpenMP enabled compiler, <code class="docutils literal notranslate"><span class=pre>cmake</span></code> installed and C++11 support. The different targets are defined in the CMakeLists.txt. Assuming your in a local clone of this repo:</p> <div class="highlight-bash notranslate"><div class=highlight><pre><span></span>mkdir build
<span class=nb>cd</span> build
cmake -DCMAKE_BUILD_TYPE<span class=o>=</span>Release ..
make forward_test <span class=c1># or other targets</span>
</pre></div> </div> </section> <section id=compiling-the-python-interface-yourself> <h2>Compiling the Python interface yourself<a class=headerlink href=#compiling-the-python-interface-yourself title="Permalink to this headline"></a></h2> <p>Compiling the CMake target <code class="docutils literal notranslate"><span class=pre>psvWave</span></code> creates a Python module for the current environments’ Python version. However, to find the right requirements, we first need to do two things:</p> <ol class="arabic simple"> <li><p>Install PyBind, to interface Python to C++, using your favourite package manager;</p></li> <li><p>Set the relevant environment variables.</p></li> </ol> <p>Before you continue, make sure you are in your desired Python environment, e.g. Conda or PyEnv. <strong>Python 3.6</strong> or higher is recommended. Also, the <code class="docutils literal notranslate"><span class=pre>python3-dev</span></code> or equivalent package is needed for compilation.</p> <section id=installing-development-dependencies> <h3>Installing development dependencies.<a class=headerlink href=#installing-development-dependencies title="Permalink to this headline"></a></h3> <p>Using your relevant package manager, you need to install all required development dependencies. To at minimum compile the interface, <code class="docutils literal notranslate"><span class=pre>cmake</span></code> and <code class="docutils literal notranslate"><span class=pre>pybind11</span></code> are required:</p> <div class="highlight-bash notranslate"><div class=highlight><pre><span></span>pip install pybind11
pip install cmake
</pre></div> </div> <p>However, you might want to perform code-formatting and run tests. To install all the dependencies for this, it might be easier to install them using the <code class="docutils literal notranslate"><span class=pre>setup.py</span></code> file. Make sure you are in the cloned repo folder and run the following:</p> <div class="highlight-bash notranslate"><div class=highlight><pre><span></span><span class=c1># On Bash / SH</span>
pip install -e .<span class=o>[</span>dev<span class=o>]</span>
<span class=c1># On ZSH</span>
pip install -e .<span class=se>\[</span>dev<span class=se>\]</span>
</pre></div> </div> </section> <section id=setting-needed-environment-variables> <h3>Setting needed environment variables<a class=headerlink href=#setting-needed-environment-variables title="Permalink to this headline"></a></h3> <p>The compiler needs three things to work correctly:</p> <ol class="arabic simple"> <li><p>the relevant PyBind files (headers);</p></li> <li><p>the relevant Python files (headers);</p></li> <li><p>the appropriate extension for the compiled file.</p></li> </ol> <p>The CMakeLists.txt file loads these variables from the environment. If you know what you are doing, you can set these yourself. If not, run the following commands in the terminal in which you have activated your relevant Python environment:</p> <div class="highlight-bash notranslate"><div class=highlight><pre><span></span><span class=nb>export</span> <span class=nv>PYBIND_INCLUDES</span><span class=o>=</span><span class=sb>`</span>python3 -c<span class=s1>&#39;import pybind11;print(pybind11.get_include())&#39;</span><span class=sb>`</span>
<span class=nb>export</span> <span class=nv>PYTHON_INCLUDES</span><span class=o>=</span><span class=sb>`</span>python3 -c<span class=s2>&quot;from sysconfig import get_paths as gp; print(gp()[\&quot;include\&quot;])&quot;</span><span class=sb>`</span>
<span class=nb>export</span> <span class=nv>SUFFIX</span><span class=o>=</span><span class=sb>`</span>python3-config --extension-suffix<span class=sb>`</span>
</pre></div> </div> </section> <section id=compiling-the-python-linked-c-code> <h3>Compiling the Python linked C++ code<a class=headerlink href=#compiling-the-python-linked-c-code title="Permalink to this headline"></a></h3> <p>Compiling the Python interface is done by running CMake in the cloned repo:</p> <div class="highlight-bash notranslate"><div class=highlight><pre><span></span>mkdir build
<span class=nb>cd</span> build
cmake -DCMAKE_BUILD_TYPE<span class=o>=</span>Release ..
make psvWave
</pre></div> </div> </section> <section id=using-the-python-interface> <h3>Using the Python interface<a class=headerlink href=#using-the-python-interface title="Permalink to this headline"></a></h3> <p>This interface can be used by having the resulting <code class="docutils literal notranslate"><span class=pre>__psvWave_cpp.*.so</span></code> file in your working directory or PATH variable, and importing it, e.g.:</p> <div class="highlight-python notranslate"><div class=highlight><pre><span></span><span class=kn>import</span> <span class=nn>__psvWave_cpp</span>

<span class=n>model</span> <span class=o>=</span> <span class=n>__psvWave_cpp</span><span class=o>.</span><span class=n>fdModel</span><span class=p>(</span>
    <span class=s2>&quot;../tests/test_configurations/forward_configuration.ini&quot;</span><span class=p>)</span>

<span class=n>model</span><span class=o>.</span><span class=n>forward_shot</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=n>verbose</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span> <span class=n>store_fields</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</pre></div> </div> <p>However, the files in the <code class="docutils literal notranslate"><span class=pre>./psvWave/</span></code> Python module provides an interface that is a little neater with additional functions. Place the .so file in this folder and have this folder in your path.</p> </section> </section> <section id=compiling-the-documentation> <h2>Compiling the documentation<a class=headerlink href=#compiling-the-documentation title="Permalink to this headline"></a></h2> <p>The documentation for the Python and C++ API requires one extra thing after running <code class="docutils literal notranslate"><span class=pre>pip</span> <span class=pre>install</span> <span class=pre>-e</span> <span class=pre>.[dev]</span></code>; A locally installed <strong>doxygen</strong>, to parse the C++ API into a Sphinx readable structure (a bunch of XML files, really. Installing this is a little platform dependent, with a quick <code class="docutils literal notranslate"><span class=pre>install</span> <span class=pre>doxygen</span> <span class=pre>&lt;platform&gt;</span></code> typically being enough. On e.g. Ubuntu the command to run would be:</p> <div class="highlight-bash notranslate"><div class=highlight><pre><span></span>$ sudo apt-get install doxygen
</pre></div> </div> <p>For compiling the total documentation the following needs to be run out of the local git clone:</p> <div class="highlight-bash notranslate"><div class=highlight><pre><span></span>$ <span class=nb>cd</span> docs-source
$ rm build/ -rf
$ make html
$ touch build/html/.nojekyll
</pre></div> </div> <p>The entire content of the <code class="docutils literal notranslate"><span class=pre>docs-source/build/html</span></code> directory, together with an empty file <code class="docutils literal notranslate"><span class=pre>.nojekyll</span></code>, is used as the gh-pages branch.</p> </section> </section> </div> </div> <footer><div class=rst-footer-buttons role=navigation aria-label=Footer> <a href=typical-workflow.html class="btn btn-neutral float-right" title="Typical FWI workflow" accesskey=n rel=next>Next <span class="fa fa-arrow-circle-right" aria-hidden=true></span></a> </div> <hr> <div role=contentinfo> <p>&#169; Copyright 2018-2022, Lars Gebraad.</p> </div> Built with <a href=https://www.sphinx-doc.org/ >Sphinx</a> using a <a href=https://github.com/readthedocs/sphinx_rtd_theme>theme</a> provided by <a href=https://readthedocs.org>Read the Docs</a>. </footer> </div> </div> </section> </div> <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> </body> </html>